---
layout: post
title: "í…ŒìŠ¤íŠ¸ EKS í™˜ê²½ì— Kubectlë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì„¤ì • ê°€ì´ë“œ"
categories: "Kubernetes"
tags: ["k8s", "kubectl"]
sidebar: ['article-menu']
---

ê°œë°œì´ë‚˜ í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ì›ê²© ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê±°ë‚˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì§ì ‘ ì¡°ì‘í•´ì•¼ í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤. ì´ ê¸€ì—ì„œëŠ” ë¡œì»¬ ë¨¸ì‹ ì—ì„œ `kubectl`ì„ ì‚¬ìš©í•˜ì—¬ AWS EKS(Elastic Kubernetes Service) í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ì•ˆì „í•˜ê²Œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì¤€ë¹„ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤.

## **ì‚¬ì „ ì¤€ë¹„ì‚¬í•­**

### **í•„ìˆ˜ ë„êµ¬**
- **AWS CLI**: ìµœì‹  ë²„ì „ (v2 ê¶Œì¥)
- **kubectl**: ëŒ€ìƒ EKS í´ëŸ¬ìŠ¤í„°ì™€ í˜¸í™˜ë˜ëŠ” ë²„ì „
- **ê¶Œí•œ ì´í•´**: IAM ì‚¬ìš©ì, ì—­í• , ì •ì±…ì— ëŒ€í•œ ê¸°ë³¸ ê°œë…

### **EKS ì ‘ê·¼ ê¶Œí•œ êµ¬ì¡°**
EKS í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ì€ ë‹¤ìŒ ë‘ ë‹¨ê³„ì˜ ê¶Œí•œ í™•ì¸ì„ ê±°ì¹©ë‹ˆë‹¤:
1. **AWS IAM ì¸ì¦**: AWS ìê²© ì¦ëª…ì„ í†µí•œ ì‹ ì› í™•ì¸
2. **Kubernetes RBAC ê¶Œí•œ**: í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ ê¶Œí•œ

ë”°ë¼ì„œ EKS í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•˜ë ¤ë©´ **Managers ê·¸ë£¹**ê³¼ ê°™ì€ ì ì ˆí•œ IAM ê·¸ë£¹ì— í¬í•¨ë˜ì–´ì•¼ í•˜ë©°, í•´ë‹¹ ê·¸ë£¹ì´ í´ëŸ¬ìŠ¤í„° ë‚´ RBACì™€ ì—°ê²°ëœ IAM ì—­í• (ì˜ˆ: `k8sAdmin`)ì„ ê°€ì •í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

## **ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**

### **ìµœì†Œ ê¶Œí•œ ì›ì¹™**
- í…ŒìŠ¤íŠ¸ í™˜ê²½ ì ‘ê·¼ì„ ìœ„í•œ ë³„ë„ì˜ IAM ì‚¬ìš©ì ìƒì„±
- í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬
- ì •ê¸°ì ì¸ ì•¡ì„¸ìŠ¤ í‚¤ ë¡œí…Œì´ì…˜ (90ì¼ ì£¼ê¸° ê¶Œì¥)

### **ìê²© ì¦ëª… ë³´ì•ˆ**
- ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ì½”ë“œë‚˜ ê³µê°œ ì €ì¥ì†Œì— ë…¸ì¶œí•˜ì§€ ì•Šê¸°
- AWS profilesë¥¼ ì‚¬ìš©í•œ í™˜ê²½ë³„ ìê²© ì¦ëª… ë¶„ë¦¬
- ê°€ëŠ¥í•œ ê²½ìš° ì„ì‹œ ìê²© ì¦ëª…(STS) ì‚¬ìš© ê³ ë ¤

## **1. IAM ì‚¬ìš©ì ë° ì•¡ì„¸ìŠ¤ í‚¤ ìƒì„±**

### **IAM ì‚¬ìš©ì ìƒì„±**
AWS ì½˜ì†”ì—ì„œ IAM ì„œë¹„ìŠ¤ë¡œ ì´ë™í•˜ì—¬ ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

1. **IAM > ì‚¬ìš©ì > ì‚¬ìš©ì ìƒì„±** í´ë¦­
2. **ì‚¬ìš©ì ì´ë¦„**: `kubectl-test-user` (ë˜ëŠ” ì ì ˆí•œ ì´ë¦„)
3. **ì•¡ì„¸ìŠ¤ ìœ í˜•**: "í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤" ì„ íƒ
4. **ê¶Œí•œ**: ê¸°ì¡´ Managers ê·¸ë£¹ì— ì¶”ê°€ ë˜ëŠ” í•„ìš”í•œ ì •ì±… ì—°ê²°

### **ì•¡ì„¸ìŠ¤ í‚¤ ìƒì„±**
ì‚¬ìš©ì ìƒì„± í›„ **ë³´ì•ˆ ìê²© ì¦ëª…** íƒ­ì—ì„œ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

- **ì•¡ì„¸ìŠ¤ í‚¤ ID**: `AKIAIOSFODNN7EXAMPLE` (ì˜ˆì‹œ)
- **ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤**: `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY` (ì˜ˆì‹œ)

> âš ï¸ **ì£¼ì˜**: ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤ëŠ” ìƒì„± ì‹œì—ë§Œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•œ ê³³ì— ì¦‰ì‹œ ì €ì¥í•˜ì„¸ìš”.

## **2. AWS Profile ì„¤ì •**

ë¡œì»¬ í™˜ê²½ì—ì„œ ì—¬ëŸ¬ AWS ê³„ì •ì´ë‚˜ í™˜ê²½ì„ ë‹¤ë£¨ëŠ” ê²½ìš°, ëª…ëª…ëœ í”„ë¡œí•„(named profile)ì„ ì‚¬ìš©í•˜ì—¬ ê° í™˜ê²½ì˜ ìê²© ì¦ëª…ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

### **í”„ë¡œí•„ ìƒì„±**
í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ìœ„í•œ ë³„ë„ì˜ AWS í”„ë¡œí•„ì„ ìƒì„±í•©ë‹ˆë‹¤:

```bash
$ aws configure --profile test
AWS Access Key ID [None]: ABCDEF  # ìœ„ì—ì„œ ìƒì„±í•œ ì•¡ì„¸ìŠ¤ í‚¤ ID
AWS Secret Access Key [None]: GHIJKL  # ìœ„ì—ì„œ ìƒì„±í•œ ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤
Default region name [None]: ap-northeast-2  # EKS í´ëŸ¬ìŠ¤í„°ê°€ ìœ„ì¹˜í•œ ë¦¬ì „
Default output format [None]: json  # ì¶œë ¥ í˜•ì‹ (json ê¶Œì¥)
```

### **ì„¤ì • íŒŒì¼ í™•ì¸**
ëª…ë ¹ ì‹¤í–‰ í›„ ìƒì„±ë˜ëŠ” ì„¤ì • íŒŒì¼ë“¤ì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤:

**`~/.aws/config`** (AWS ì„¤ì • íŒŒì¼)
```ini
[profile test]
region = ap-northeast-2
output = json
```

**`~/.aws/credentials`** (ìê²© ì¦ëª… íŒŒì¼)
```ini
[test]
aws_access_key_id = ABCDEF
aws_secret_access_key = GHIJKL
```

> ğŸ’¡ **íŒ**: í”„ë¡œí•„ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸/ìš´ì˜ í™˜ê²½ì˜ ìê²© ì¦ëª…ì„ ë¶„ë¦¬í•˜ì—¬ ì‹¤ìˆ˜ë¡œ ì˜ëª»ëœ í™˜ê²½ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.

## **3. kubectl Context ì¶”ê°€**

### **EKS í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ kubeconfigì— ì¶”ê°€**
AWS CLIë¥¼ ì‚¬ìš©í•˜ì—¬ EKS í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ ë¡œì»¬ì˜ `kubeconfig` íŒŒì¼ì— ì¶”ê°€í•©ë‹ˆë‹¤:

```bash
aws eks update-kubeconfig \
    --region ap-northeast-2 \
    --name lemonbase-test \
    --role-arn arn:aws:iam::455628414130:role/k8sAdmin \
    --alias lemonbase-test \
    --profile test
```

### **ëª…ë ¹ì–´ ì˜µì…˜ ì„¤ëª…**
- `--region`: EKS í´ëŸ¬ìŠ¤í„°ê°€ ìœ„ì¹˜í•œ AWS ë¦¬ì „
- `--name`: EKS í´ëŸ¬ìŠ¤í„° ì´ë¦„
- `--role-arn`: í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ê¶Œí•œì„ ê°€ì§„ IAM ì—­í•  ARN
- `--alias`: kubectlì—ì„œ ì‚¬ìš©í•  ì»¨í…ìŠ¤íŠ¸ ë³„ì¹­
- `--profile`: ì‚¬ìš©í•  AWS í”„ë¡œí•„ ì´ë¦„

> âš ï¸ **ì¤‘ìš”**: `--role-arn`ì— ì§€ì •ëœ ì—­í• ì€ EKS í´ëŸ¬ìŠ¤í„°ì˜ `aws-auth` ConfigMapì—ì„œ Kubernetes ê¶Œí•œê³¼ ë§¤í•‘ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

## **4. ì„¤ì • í™•ì¸ ë° ê²€ì¦**

### **ì»¨í…ìŠ¤íŠ¸ ì„¤ì • í™•ì¸**
ì¶”ê°€ëœ ì»¨í…ìŠ¤íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤:

```bash
# ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ ëª©ë¡ í™•ì¸
kubectl config get-contexts

# í˜„ì¬ í™œì„± ì»¨í…ìŠ¤íŠ¸ í™•ì¸
kubectl config current-context

# kubeconfig ì „ì²´ ì„¤ì • í™•ì¸
kubectl config view
```

### **í´ëŸ¬ìŠ¤í„° ì—°ê²° í…ŒìŠ¤íŠ¸**
ì‹¤ì œ í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤:

```bash
# í´ëŸ¬ìŠ¤í„° ì •ë³´ í™•ì¸
kubectl cluster-info

# ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ íŒŒë“œ ëª©ë¡ ì¡°íšŒ
kubectl get pods -A

# ë…¸ë“œ ì •ë³´ í™•ì¸
kubectl get nodes
```

## **ë¬¸ì œ í•´ê²° (Troubleshooting)**

### **ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ë° í•´ê²°ë°©ë²•**

#### **1. ì¸ì¦ ì‹¤íŒ¨ ì˜¤ë¥˜**
```
error: You must be logged in to the server (Unauthorized)
```
**í•´ê²°ë°©ë²•**:
- AWS ìê²© ì¦ëª…ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- IAM ì‚¬ìš©ìê°€ ì˜¬ë°”ë¥¸ ê·¸ë£¹ì— ì†í•´ìˆëŠ”ì§€ í™•ì¸
- `aws sts get-caller-identity --profile test`ë¡œ í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸

#### **2. ì—­í•  ê°€ì • ì‹¤íŒ¨**
```
error: unable to assume role
```
**í•´ê²°ë°©ë²•**:
- IAM ì‚¬ìš©ìì—ê²Œ `sts:AssumeRole` ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸
- ì—­í• ì˜ ì‹ ë¢° ì •ì±…ì—ì„œ í•´ë‹¹ ì‚¬ìš©ìë‚˜ ê·¸ë£¹ì´ í—ˆìš©ë˜ëŠ”ì§€ í™•ì¸

#### **3. í´ëŸ¬ìŠ¤í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ**
```
error: cluster not found
```
**í•´ê²°ë°©ë²•**:
- í´ëŸ¬ìŠ¤í„° ì´ë¦„ê³¼ ë¦¬ì „ì´ ì •í™•í•œì§€ í™•ì¸
- AWS CLI í”„ë¡œí•„ì´ ì˜¬ë°”ë¥¸ ê³„ì •ì„ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸

### **ê¶Œí•œ í™•ì¸ ëª…ë ¹ì–´**
```bash
# í˜„ì¬ AWS ì¸ì¦ ì •ë³´ í™•ì¸
aws sts get-caller-identity --profile test

# EKS í´ëŸ¬ìŠ¤í„° ëª©ë¡ í™•ì¸
aws eks list-clusters --region ap-northeast-2 --profile test

# íŠ¹ì • í´ëŸ¬ìŠ¤í„° ì •ë³´ í™•ì¸
aws eks describe-cluster --name lemonbase-test --region ap-northeast-2 --profile test
```

## **ê³ ê¸‰ ì‚¬ìš©ë²•**

### **ë‹¤ì¤‘ í™˜ê²½ ê´€ë¦¬**
ì—¬ëŸ¬ í™˜ê²½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë°©ë²•:

```bash
# ì»¨í…ìŠ¤íŠ¸ ì „í™˜
kubectl config use-context lemonbase-production
kubectl config use-context lemonbase-staging
kubectl config use-context lemonbase-test

# í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ í™•ì¸
kubectl config current-context

# íŠ¹ì • ì»¨í…ìŠ¤íŠ¸ë¡œ ëª…ë ¹ ì‹¤í–‰ (ì»¨í…ìŠ¤íŠ¸ ì „í™˜ ì—†ì´)
kubectl --context=lemonbase-test get pods
```

### **kubeconfig íŒŒì¼ êµ¬ì¡°**
`~/.kube/config` íŒŒì¼ì˜ êµ¬ì¡°ë¥¼ ì´í•´í•˜ë©´ ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë©ë‹ˆë‹¤:

```yaml
apiVersion: v1
kind: Config
clusters:
- cluster:
    server: https://xxx.gr7.ap-northeast-2.eks.amazonaws.com
  name: arn:aws:eks:ap-northeast-2:455628414130:cluster/lemonbase-test
contexts:
- context:
    cluster: arn:aws:eks:ap-northeast-2:455628414130:cluster/lemonbase-test
    user: arn:aws:eks:ap-northeast-2:455628414130:cluster/lemonbase-test
  name: lemonbase-test
users:
- name: arn:aws:eks:ap-northeast-2:455628414130:cluster/lemonbase-test
  user:
    exec:
      command: aws
      args:
      - eks
      - get-token
      - --cluster-name
      - lemonbase-test
      - --region
      - ap-northeast-2
      - --role-arn
      - arn:aws:iam::455628414130:role/k8sAdmin
      - --profile
      - test
```

## **ë³´ì•ˆ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**

### **ì •ê¸°ì ì¸ ë³´ì•ˆ ê´€ë¦¬**
- **ì•¡ì„¸ìŠ¤ í‚¤ ë¡œí…Œì´ì…˜**: 90ì¼ë§ˆë‹¤ ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í‚¤ë¡œ êµì²´
- **ê¶Œí•œ ìµœì†Œí™”**: ë¶ˆí•„ìš”í•œ ê¶Œí•œ ì œê±°
- **ì ‘ê·¼ ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: CloudTrailì„ í†µí•œ API í˜¸ì¶œ ì¶”ì 

### **ëŒ€ì•ˆì  ì¸ì¦ ë°©ë²•**
- **AWS SSO**: ì¡°ì§ì—ì„œ SSOë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ê³ ë ¤
- **eksctl**: ë” ê°„ë‹¨í•œ EKS í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ë„êµ¬
- **IAM Roles for Service Accounts (IRSA)**: ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì¤€ì—ì„œì˜ ê¶Œí•œ ê´€ë¦¬

## **ìš”ì•½**

ì´ ê°€ì´ë“œë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤:

1. âœ… **IAM ì‚¬ìš©ì ìƒì„±** - ìµœì†Œ ê¶Œí•œìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì ‘ê·¼ ê³„ì • ì¤€ë¹„
2. âœ… **AWS í”„ë¡œí•„ ì„¤ì •** - í™˜ê²½ë³„ ìê²© ì¦ëª… ë¶„ë¦¬
3. âœ… **kubectl ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€** - EKS í´ëŸ¬ìŠ¤í„° ì—°ê²° ì„¤ì •
4. âœ… **ì—°ê²° ê²€ì¦** - ì‹¤ì œ í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ í…ŒìŠ¤íŠ¸

### **ë‹¤ìŒ ë‹¨ê³„**
- Kubernetes ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ RBAC ê¶Œí•œ ì„¤ì •
- Helm ì°¨íŠ¸ ë°°í¬ ë° ê´€ë¦¬
- ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì†”ë£¨ì…˜ ì—°ë™

ì´ì œ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì—¬ëŸ¬ EKS í™˜ê²½ì„ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì´ ë§ˆë ¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ë¬¸ì œ í•´ê²° ì„¹ì…˜ì„ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
