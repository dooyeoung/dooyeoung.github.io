---
layout: post
title: "서비스 도메인 변경 작업"
subtitle: 회사명과 제품명은 분리하여 사용하자
categories: ["도메인 변경"]
tags: ["operation"]
sidebar: ['article-menu']
---

스포카의 도도포인트 팀이 야놀자에 매각되었습니다.
도도포인트 여러 서비스에서 사용중인 spoqa.com 도메인을 dodopoint.com 으로 변경해야 하는 작업을 맡게 되었습니다.



## 현황 파악
record53에서 spoqa.com 호스트에 등록된 모든 레코드를 확인하여 사용여부와 연결지점을 확인하였습니다.
크게 cloudfront, loadbalancer, ec2, apigateway 연결되는 형태였으며 추가로 acm 인증까지 확인해야 했습니다.


## 도메인 이중화
k8s 환경에서 `aws load balancer controller`를 사용하여 ingress 를 관리하고 있었으며 ingress를 추가하여
api 서버에 대한 접속을 이중화하였습니다.
서비스는 *.spoqa.com 으로만 접속이 가능했지만 작업 후 *.dodopoint.com url 으로도 접속이 가능해졌습니다.

> 제품명에 회사명을 포함하면 크게 후회 할 일이 발생한 다는것을 깨달았습니다.


## 서비스의 코드 수정
도메인 이중화 작업을 마무리하였으니 api 서버에서 사용중인 spoqa.com url을 모두 변경합니다.
사실 이작업이 간단하지만 어떤 영향을 줄지 장애가 발생할지 미리 파악하고 작업해야 하기에 간단한 작업은 아닙니다.

설정은 *.toml 파일로 모든 설정값을 관리하고 있어 변경 작업은 간단했습니다.
영향 범위를 파악하는 작업이 간단하지 않았습니다.


